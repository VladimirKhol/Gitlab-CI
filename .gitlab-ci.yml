# .gitlab-ci.yml

stages:
  - selenoid_start
  - test
  - selenoid_stop

before_script:
  - apt-get update
  - apt-get install -y libglib2.0-0 libnss3 libxcb1

selenoid:
  stage: selenoid_start
  image: aerokube/selenoid:latest-release
  script:
    - selenoid start --vnc
  tags:
    - selenium-runner

selenium_tests:
  stage: test
  services:
    - name: aerokube/selenoid:latest-release
      alias: selenoid
  variables:
    SELENOID_URL: http://selenoid:4444/wd/hub
  image: maven:latest
  script:
    - mvn clean test
  only:
    refs:
      - schedules
  tags:
    - selenium-runner
  when: always

selenoid_stop:
  stage: selenoid_stop
  image: aerokube/selenoid:latest-release
  script:
    - selenoid stop
  tags:
    - selenium-runner